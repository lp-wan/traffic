<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>CoAP Traffic</title>

  
<style type="text/css">/*<![CDATA[*/
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

@media screen and (min-width: 1024px) {
  ul.toc, #rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    padding: 0 1em;
    z-index: 1;
  }
  #rfc\.toc {
    top: 16px;
  }
  ul.toc {
    top: 80px;
    overflow: auto;
  }

  body {
    padding-left: 1.5em;
    padding-right: 29em;
  }
}

body {
  font: 15px "Helvetica Neue",Helvetica,Arial,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 130%;
  margin: 2.5em auto;
  max-width: 724px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
  font-size-adjust: 0.5;
  font-weight: 500;
  color: #333;
  line-height: 100%;
  margin: 0.8em 0 0.3em;
}
.title { font-size: 36px; }
h1 { font-size: 30px; }
h2 { font-size: 24px; }
h3, h4 { font-size: 18px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

ul.toc li {
  list-style: none;
  text-indent: -2.5em;
  padding-left: 2.5em;
  padding-bottom: 5px;
  margin: 0;
}
ul.toc ul {
  margin: 0;
}
/* xml2rfc nests ul directly inside ul which messes with the style badly */
ul.toc, ul.toc>ul, ul.toc ul>ul {
  margin: 0 0 0 1.5em;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header {
  width: 100%;
}
table.header td {
  border: none;
  background-color: transparent;
  color: black;
}
.filename {
  color: rgb(119, 119, 119);
  font-size: 23px;
  font-weight: normal;
  height: auto;
  line-height: 100%;
}
#rfc\.abstract+p {
  font-size: 20px;
  font-weight: 300;
  line-height: 130%;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure {
  font-style: italic;
  margin: 0 1.5em;
}

address {
  margin: 10px 0 0;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn {
  font-weight: bold;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

ol, ul, li, p {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
li, p {
  margin-left: 0;
}
address {
  font-style: normal;
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>


  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.2" rel="Chapter" title="2 scenario 1 - Unidirectional traffic"/>
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 CoAP POST without Acknowledgement from thing"/>
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Scenario 2 - CoAP POST without Acknowledgement to thing"/>
<link href="#rfc.section.3" rel="Chapter" title="3 bi-directional traffic"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Scenario 3 - CoAP ack"/>
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Scenario 4 - REST ack"/>
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Scenario 5 - GET"/>
<link href="#rfc.section.4" rel="Chapter" title="4 CoMI"/>
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 GET"/>
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 FETCH"/>
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 PUT/POST"/>
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 iPATCH"/>
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 DELETE"/>
<link href="#rfc.section.4.6" rel="Chapter" title="4.6 Examples"/>
<link href="#rfc.references" rel="Chapter" title="5 Normative References"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.2 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Minaburo, A. and L. Toutain" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-toutain-lpwan-coap-traffic-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2016-4" />
  <meta name="dct.abstract" content="This document describes different CoAP scenarios for the SCHC compression.  It goes from the simplest exchange without acknowledgments to a basic study of the CoMI traffic." />
  <meta name="description" content="This document describes different CoAP scenarios for the SCHC compression.  It goes from the simplest exchange without acknowledgments to a basic study of the CoMI traffic." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Network Working Group</td>
  <td class="right">A. Minaburo</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">Acklio</td>
</tr>
<tr>
  <td class="left">Intended status: Informational</td>
  <td class="right">L. Toutain</td>
</tr>
<tr>
  <td class="left">Expires: October 3, 2016</td>
  <td class="right">Institut Mines Telecom Atlantique</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">April 2016</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">CoAP Traffic<br />
  <span class="filename">draft-toutain-lpwan-coap-traffic-latest</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>This document describes different CoAP scenarios for the SCHC compression.  It goes from the simplest exchange without acknowledgments to a basic study of the CoMI traffic.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on October 3, 2016.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2016 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>
<h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a></h1>
<p id="rfc.section.1.p.1">This document describes different CoAP scenarios for the SCHC compression.  It goes from the simplest exchange without acknowledgments to a basic study of the CoMI traffic.  These scenarios currently do not cover cases where encryption is used (COSE, OSCOAP,&#8230;).</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#scenario-1-unidirectional-traffic" id="scenario-1-unidirectional-traffic">scenario 1 - Unidirectional traffic</a></h1>
<h1 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a> <a href="#FromThingPOSTnoAck" id="FromThingPOSTnoAck">CoAP POST without Acknowledgement from thing</a></h1>
<p id="rfc.section.2.1.p.1">The thing sends a CoAP POST/PUT request without acknowledgment using CoAP NON message and no response option <a href="#RFC7967">[RFC7967]</a>. This is a common traffic in a LPWAN network to minimize the downlink.</p>
<div id="rfc.figure.1"/>
<div id="Fig-Thing-Simple-POST"/>
<pre>
 thing                          LPWAN SCHC                   CoAP Server
|                                |                                |
|                                |   NON POST MID=0x00AB          |
|                                |   Token = 0x11                 |
|                                |   Path = /elm1/elm2            |
|                                |   Content-format = val         |
|                                |   NoResponse = 0|2|8|16        |
|     rule-id value              |   Value                        |
|-------------------------------&gt;|                                |
|                                | ------------------------------&gt;|



</pre>
<p class="figure">Figure 1: POST with no ACK</p>
<p id="rfc.section.2.1.p.2">Compression Objectives:</p>
<p/>

<ul>
  <li>do not send version, type, token length, code because they are defined in the rule.</li>
  <li>compress Message ID and Token.</li>
  <li>do not sent options because they are defined in the rule.</li>
  <li>send value *** NOTE: The Mid may not be sent, since no acknowledgement is expected.  Nevertheless several copies of the same message will not be detected by the receiver which will view them as several requests. This can be solved at L2 if the technology sends the frame with unique value.</li>
</ul>
<h1 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a> <a href="#scenario-2-coap-post-without-acknowledgement-to-thing" id="scenario-2-coap-post-without-acknowledgement-to-thing">Scenario 2 - CoAP POST without Acknowledgement to thing</a></h1>
<p id="rfc.section.2.2.p.1">Same as <a href="#FromThingPOSTnoAck">Section 2.1</a> but request comes from network to thing.  Selected values for Mid, token need to be control to allow a better compression rate. A CoAP proxy is need to normalize these values.</p>
<div id="rfc.figure.2"/>
<div id="Fig-Network-simple-POST"/>
<pre>
thing                          LPWAN SCHC                  CoAP Server
|                                |                                |
|                                |   NON POST MID=0xCDAB          |
|                                |   Token = 0x11223344           |
|                                |   Path = /elm1/elm2            |
|                                |   Content-format = val         |
|                                |   NoResponse = 0|2|8|16        |
|                                |   Value                        |
|    rule-id Value               |&lt;-------------------------------|
|&lt;-------------------------------|                                |
|                                |                                |



</pre>
<p class="figure">Figure 2: POST with no ACK</p>
<p id="rfc.section.2.2.p.2">Compression Objectives:</p>
<p/>

<ul>
  <li>do not send version, type, token length, code because they are defined in the rule.</li>
  <li>reduce value size and compress Message ID and Token.</li>
  <li>do not sent options because they are defined in the rule</li>
  <li>send value</li>
</ul>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#bi-directional-traffic" id="bi-directional-traffic">bi-directional traffic</a></h1>
<h1 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> <a href="#scenario-3-coap-ack" id="scenario-3-coap-ack">Scenario 3 - CoAP ack</a></h1>
<p id="rfc.section.3.1.p.1">Same as <a href="#FromThingPOSTnoAck">Section 2.1</a> but the network acknowledge the CoAP message.</p>
<div id="rfc.figure.3"/>
<div id="Fig-Thing-Simple-POST-CoAPAcked"/>
<pre>
thing                          LPWAN SCHC                   CoAP Server
|                                |                                |
|                                |   CON POST MID=0x00AB          |
|                                |   Token = 0x11                 |
|                                |   Path = /elm1/elm2            |
|                                |   Content-format = val         |
|            TDB                 |   NoResponse = 0|2|8|16        |
|-------------------------------&gt;|   Value                        |
|                                |-------------------------------&gt;|
|                                |                                |
|                                |   ACK 0.00 MID=0x00AB          |
|            TBD                 |&lt;-------------------------------|
|&lt;-------------------------------|



</pre>
<p class="figure">Figure 3: POST with no ACK</p>
<p id="rfc.section.3.1.p.2">Objectives:</p>
<p/>

<ul>
  <li>Thing  <ul><li>do not send version, token length.</li><li>compress type, Message ID, Token and code.</li><li>do not sent options.</li><li>send value</li></ul></li>
  <li>Network  <ul><li>compress type and code.</li></ul></li>
</ul>
<h1 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> <a href="#FromThingPOSTwithAck" id="FromThingPOSTwithAck">Scenario 4 - REST ack</a></h1>
<p id="rfc.section.3.2.p.1">Same as <a href="#FromThingPOSTnoAck">Section 2.1</a> but the thing wait for an acknowledgement at REST level. Response code can be 2.04, 2.01, 2.02, 4.0Y, 5.0Y.</p>
<div id="rfc.figure.4"/>
<div id="Fig-Thing-Simple-POST-Acked"/>
<pre>
thing                          LPWAN SCHC                   CoAP Server
|                                |                                |
|                                |   NON POST MID=0x00AB          |
|                                |   Token = 0x11                 |
|                                |   Path = /elm1/elm2            |
|-------------------------------&gt;|   Value                        |
|            TBD                 |-------------------------------&gt;|
|                                |                                |
|                                |   NON X.YY MID=0x1234          |
|                                |   Token = 0x11                 |
|            TBD                 |&lt;-------------------------------|
|&lt;-------------------------------|                                |



</pre>
<p class="figure">Figure 4: POST with no ACK</p>
<p id="rfc.section.3.2.p.2">Objectives:</p>
<p/>

<ul>
  <li>Thing  <ul><li>do not send version, token length.</li><li>compress type, Message ID and Token.</li><li>compress code.</li><li>do not sent options</li><li>send value</li></ul></li>
  <li>Network  <ul><li>do not send version, token length.</li><li>compress type, Message ID and token.</li><li>reduce MID size in response and compress it.</li></ul></li>
</ul>
<h1 id="rfc.section.3.3"><a href="#rfc.section.3.3">3.3.</a> <a href="#scenario-5-get" id="scenario-5-get">Scenario 5 - GET</a></h1>
<p id="rfc.section.3.3.p.1">Same as <a href="#FromThingPOSTwithAck">Section 3.2</a> but GET request and value in response..</p>
<div id="rfc.figure.5"/>
<div id="Fig-Thing-Simple-GET"/>
<pre>
thing                          LPWAN SCHC                     CoAP Server
|                                |                                |
|                                |   NON GET MID=0x00AB           |
|                                |   Token = 0x11                 |
|          TBD                   |   Accept = val                 |
|-------------------------------&gt;|   Path = /elm1/elm2            |
|                                |-------------------------------&gt;|
|                                |                                |
|                                |   NON 2.05 MID=0x1234          |
|                                |   Token = 0x11                 |
|                                |   Content-format = val         |
|                                |   Value                        |
|          TDB                   |&lt;-------------------------------|
|&lt;-------------------------------|                                |



</pre>
<p class="figure">Figure 5: POST with no ACK</p>
<p id="rfc.section.3.3.p.2">Objectives:</p>
<p/>

<ul>
  <li>Thing  <ul><li>do not send version, type, token length.</li><li>compress Message ID and Token.</li><li>compress code.</li><li>do not sent options</li></ul></li>
  <li>Network  <ul><li>reduce MID size in response and compress it.</li><li>compress code.</li><li>send token.</li><li>send value</li></ul></li>
</ul>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#comi" id="comi">CoMI</a></h1>
<p><a href="#I-D.vanderstok-core-comi">[I-D.vanderstok-core-comi]</a> defines the different exchanges using CoMI.  The path /c gives access to the CoMI module.</p>
<h1 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1.</a> <a href="#get" id="get">GET</a></h1>
<p id="rfc.section.4.1.p.1">With the GET method, /c is followed by the SID integer value coded in base64.  A query parameter allows to specify a particular instance by sending the YANG keys.  If no value is given then the full structure is returned.  For instance (taken from the draft):</p>
<p/>

<ul>
  <li>GET /c/a3</li>
  <li>GET /c/Bf4?k=&#8221;eth0&#8221;</li>
  <li>GET /c</li>
</ul>
<p id="rfc.section.4.1.p.3">Objective:</p>
<p/>

<ul>
  <li>allow to compress partially the path and send only the SID value on the radio link.</li>
</ul>
<h1 id="rfc.section.4.2"><a href="#rfc.section.4.2">4.2.</a> <a href="#fetch" id="fetch">FETCH</a></h1>
<p id="rfc.section.4.2.p.1">The FETCH method uses a CBOR structure sent in the payload instead of the URI.</p>
<div id="rfc.figure.6"/>
<div id="FETCHStructure"/>
<pre>
FETCH /c/ Content-Format (application/YANG-fetch+cbor)
       &lt;CBOR array of instance identifiers&gt;
</pre>
<p class="figure">Figure 6: FETCH Structure</p>
<p id="rfc.section.4.2.p.2">The CBOR structure is an array containing either CBOR Integer for SID or array with a SID and a list of filtering parameters.</p>
<div id="rfc.figure.7"/>
<div id="Simple-FETCH"/>
<pre>
FETCH /c Content-Format (application/YANG-fetch+cbor)
   [ 1719,              # ID 1719
     [-186, "eth0"]   # ID 1533 with name = "eth0"
   ]
</pre>
<p class="figure">Figure 7: FETCH with CBOR parameters</p>
<p id="rfc.section.4.2.p.3">For the compression point of view, Fetch is a new code value 0.05. But to send dynamically SIDs and keys, the CBOR structure must be understood by SCHC.</p>
<h1 id="rfc.section.4.3"><a href="#rfc.section.4.3">4.3.</a> <a href="#putpost" id="putpost">PUT/POST</a></h1>
<p id="rfc.section.4.3.p.1">PUT allows to remplace or create a data resource instance, POST always add a data resource instance. Draft imposes to use a confirmable CoAP message (which may not needed since there is REST confirmation). POST URI contains only the SID value and PUT can add a query parameter with keys.</p>
<h1 id="rfc.section.4.4"><a href="#rfc.section.4.4">4.4.</a> <a href="#ipatch" id="ipatch">iPATCH</a></h1>
<p id="rfc.section.4.4.p.1">As for FETCH, the URI is static and the parameters are sent in a CBOR array containing the SID and then values.</p>
<div id="rfc.figure.8"/>
<div id="Simple-iPATCH"/>
<pre>
   iPATCH /c Content-Format(application/YANG-patch+cbor)
   [
     [1533, "eth0"] ,                # interface (ID = 1533)
       {
         +4 : "eth0",                # name (ID 1537)
         +1 : "Ethernet adaptor",    # description (ID 1534)
         +5 : 1179,                  # type (ID 1538),
                                     # identity ethernetCsmacd
         +2 : true                   # enabled (ID 1535)
       }
     +203 , 60          # timezone-utc-offset (delta = 1736 - 1533)
   ]

   2.04 Changed
</pre>
<p class="figure">Figure 8: iPATCH with CBOR parameters</p>
<h1 id="rfc.section.4.5"><a href="#rfc.section.4.5">4.5.</a> <a href="#delete" id="delete">DELETE</a></h1>
<p id="rfc.section.4.5.p.1">If GET and PUT/POST can be replaced by FETCH and iPATCH to have a more compact representation of SID and keys, DELETE imposes to put these values in the URI.</p>
<h1 id="rfc.section.4.6"><a href="#rfc.section.4.6">4.6.</a> <a href="#examples" id="examples">Examples</a></h1>
<p><a href="#Fig-generic-rule-tree">Figure 9</a> gives the YANG module tree for SCHC. Two keys are defined: one for the rule-id and the other for the position (field-id).</p>
<div id="rfc.figure.9"/>
<div id="Fig-generic-rule-tree"/>
<pre>
module: ietf-lpwan-compression
    +--rw compression-context
       +--rw context-rules* [rule-id]
          +--rw rule-id        uint8
          +--rw rule-fields* [position]
             +--rw name?                                       string
             +--rw position                                    uint8
             +--rw target-value?                               lpwan-types
             +--rw matching-operator?                          matching-operator-type
             +--rw matching-operator-value?                    lpwan-types
             +--rw compression-decompression-function?         compression-decompression-function-type
             +--rw compression-decompression-function-value?   lpwan-types


</pre>
<p class="figure">Figure 9: Generic module tree</p>
<p><a href="#Fig-generic-rule-sid">Figure 10</a> gives some SID value that may be applied to this YANG module. Note that Matching Operators and Compression/Decompression Functions are identified by a SID value.</p>
<div id="rfc.figure.10"/>
<div id="Fig-generic-rule-sid"/>
<pre>
SID        Assigned to
---------  --------------------------------------------------
1000       Module ietf-lpwan-compression
1001       identity /compression-decompression-function
1002       identity /compression-decompression-function/cdf-compute-ipv6-length
1003       identity /compression-decompression-function/cdf-compute-udp-checksum
1004       identity /compression-decompression-function/cdf-compute-udp-length
1005       identity /compression-decompression-function/cdf-esiid-did
1006       identity /compression-decompression-function/cdf-laiid-did
1007       identity /compression-decompression-function/cdf-lsb
1008       identity /compression-decompression-function/cdf-not-sent
1009       identity /compression-decompression-function/cdf-value-sent
1010       identity /matching-operator
1011       identity /matching-operator/mo-equal
1012       identity /matching-operator/mo-ignore
1013       identity /matching-operator/mo-msb
1014       node /compression-context
1015       node /compression-context/context-rules
1016       node /compression-context/context-rules/rule-fields
1017       node /compression-context/context-rules/rule-fields/compression-decompression-function
1018       node /compression-context/context-rules/rule-fields/compression-decompression-function-value
1019       node /compression-context/context-rules/rule-fields/matching-operator
1020       node /compression-context/context-rules/rule-fields/matching-operator-value
1021       node /compression-context/context-rules/rule-fields/name
1022       node /compression-context/context-rules/rule-fields/position
1023       node /compression-context/context-rules/rule-fields/target-value
1024       node /compression-context/context-rules/rule-id

File ietf-lpwan-compression@2016-11-01.sid created
Number of SIDs available : 200
Number of SIDs assigned : 25

</pre>
<p class="figure">Figure 10: Example of SID allocation</p>
<p id="rfc.section.4.6.p.3">Some simple scenarii where SCHC rules can be modified:</p>
<p/>

<ul>
  <li>a thing selects a dynamic port number for a flow and informs the other end of this value.</li>
  <li>a thing informs the other end of the destination IPv6 address.</li>
  <li>Network informs the thing of the IPv6 prefix <a href="#Fig-iPATCH-example">Figure 11</a> gives an example of a simple request where:</li>
  <li>field-SID contains the SID value identifying the Target Value (1023 in <a href="#Fig-generic-rule-sid">Figure 10</a>  ),</li>
  <li>rule-id is the rule to be modified</li>
  <li>field-pos is the value indicating that it is respectively a ESport, or a prefix</li>
</ul>
<div id="rfc.figure.11"/>
<div id="Fig-iPATCH-example"/>
<pre>
iPATCH /c Content-Format(application/YANG-patch+cbor)
[
  [field-SID, rule-id, field-pos], value
]

</pre>
<p class="figure">Figure 11: YANG definition of the IPv6 UDP compression</p>
<p id="rfc.section.4.6.p.5">To set a port number for Rule 10 a CoMI iPTACH is sent. The rule 1 is used for that CoMI request and contains the Path, the content-format values and also the field-SID for Target Value (1023).</p>
<div id="rfc.figure.12"/>
<div id="Fig-CoAP-header-2"/>
<pre>
  +----------------+------------------------+----------------+-----------------+
  | Field          |   Function             | Target Value   | Sent compressed |
  +----------------+------------------------+----------------+-----------------+
  |CoAP version    | not-sent               | 1              |                 |
  |CoAP Type       | not-sent               | CON*           | t               |
  |CoAP TKL        | compute-token-length   |                |                 |
  |CoAP Code       | map-code               | mapping table  |  CC             |
  |CoAP MID        | remapping              | 7 bits         |    MM           |
  |CoAP Token      | remapping              | 8 bits         |       TTT       |
  |CoAP Path       | not-sent               | /c             |                 |
  |CoAP content-F  | not-sent               | YANG-patch+cbor|                 |
  +----------------+------------------------+----------------+-----------------+
  * draft mandate a Confirmable message
</pre>
<p class="figure">Figure 12: CoAP Context to compress header with token</p>
<p id="rfc.section.4.6.p.6">Where t defines the request type (0: CON, 1: ACK), CC defines the code (00: iPTACH, 01: 2.04, 10: ????, 11: ????). Message id is remapped in 2 bits which allows 4 messages  simultaneously in the air and Token to 3 bits which allows 8 simultaneous pending requests.</p>
<p id="rfc.section.4.6.p.7">The objective will be to sent on the radio link a message containing:</p>
<p/>

<ul>
  <li>rule-id for CoMI message : 0x01</li>
  <li>CoAP header : 0xXX (1 byte)</li>
  <li>CBOR Rule-id : 0x0A (10 in the example) (1 byte)</li>
  <li>CBOR position to identify ESport : 0xPPPPPPPP (4 bytes)</li>
  <li>CBOR port number value : 0xPPPP (2 bytes) Therefore 9 bytes are sent on the LPWAN radio link.</li>
</ul>
<h1 id="rfc.references"><a href="#rfc.references">5.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.vanderstok-core-comi">[I-D.vanderstok-core-comi]</b>
      </td>
      <td class="top"><a>Stok, P.</a>, <a>Bierman, A.</a>, <a>Veillette, M.</a> and <a>A. Pelov</a>, "<a href="http://tools.ietf.org/html/draft-vanderstok-core-comi-11">CoAP Management Interface</a>", Internet-Draft draft-vanderstok-core-comi-11, January 2017.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7967">[RFC7967]</b>
      </td>
      <td class="top"><a>Bhattacharyya, A.</a>, <a>Bandyopadhyay, S.</a>, <a>Pal, A.</a> and <a>T. Bose</a>, "<a href="http://tools.ietf.org/html/rfc7967">Constrained Application Protocol (CoAP) Option for No Server Response</a>", RFC 7967, DOI 10.17487/RFC7967, August 2016.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Ana Minaburo</span> 
	  <span class="n hidden">
		<span class="family-name">Minaburo</span>
	  </span>
	</span>
	<span class="org vcardline">Acklio</span>
	<span class="adr">
	  <span class="vcardline">2bis rue de la Chataigneraie</span>

	  <span class="vcardline">
		<span class="locality">35510 Cesson-Sevigne Cedex</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ana@ackl.io">ana@ackl.io</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Laurent Toutain</span> 
	  <span class="n hidden">
		<span class="family-name">Toutain</span>
	  </span>
	</span>
	<span class="org vcardline">Institut Mines Telecom Atlantique</span>
	<span class="adr">
	  <span class="vcardline">2 rue de la Chataigneraie</span>
<span class="vcardline">CS 17607</span>

	  <span class="vcardline">
		<span class="locality">35576 Cesson-Sevigne Cedex</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:Laurent.Toutain@imt-atlantique.fr">Laurent.Toutain@imt-atlantique.fr</a></span>

  </address>
</div>
  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>2.   <a href="#rfc.section.2">scenario 1 - Unidirectional traffic</a></li>
<ul><li>2.1.   <a href="#rfc.section.2.1">CoAP POST without Acknowledgement from thing</a></li>
<li>2.2.   <a href="#rfc.section.2.2">Scenario 2 - CoAP POST without Acknowledgement to thing</a></li>
</ul><li>3.   <a href="#rfc.section.3">bi-directional traffic</a></li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Scenario 3 - CoAP ack</a></li>
<li>3.2.   <a href="#rfc.section.3.2">Scenario 4 - REST ack</a></li>
<li>3.3.   <a href="#rfc.section.3.3">Scenario 5 - GET</a></li>
</ul><li>4.   <a href="#rfc.section.4">CoMI</a></li>
<ul><li>4.1.   <a href="#rfc.section.4.1">GET</a></li>
<li>4.2.   <a href="#rfc.section.4.2">FETCH</a></li>
<li>4.3.   <a href="#rfc.section.4.3">PUT/POST</a></li>
<li>4.4.   <a href="#rfc.section.4.4">iPATCH</a></li>
<li>4.5.   <a href="#rfc.section.4.5">DELETE</a></li>
<li>4.6.   <a href="#rfc.section.4.6">Examples</a></li>
</ul><li>5.   <a href="#rfc.references">Normative References</a></li>
<li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  

  <div class="github-fork-ribbon-wrapper"><div class="github-fork-ribbon"><a href="https://github.com/lp-wan/traffic">Fork me on GitHub</a></div></div>
</body>
</html>
